# Additional security configurations for nginx

# Hide nginx version information
server_tokens off;

# Prevent access to sensitive files
location ~ /\.ht {
    deny all;
    access_log off;
    log_not_found off;
}

# Prevent access to backup files
location ~ ~$ {
    deny all;
    access_log off;
    log_not_found off;
}

# Prevent access to configuration files
location ~ \.(conf|env)$ {
    deny all;
    access_log off;
    log_not_found off;
}

# Rate limiting for API endpoints (if any)
location /api/ {
    limit_req zone=api burst=5 nodelay;

    # Additional security for API endpoints
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "DENY" always;
}

# Logging configuration
log_format security '$remote_addr - $remote_user [$time_local] '
                    '"$request" $status $body_bytes_sent '
                    '"$http_referer" "$http_user_agent" '
                    'rt=$request_time uct="$upstream_connect_time" '
                    'uht="$upstream_header_time" urt="$upstream_response_time"';

access_log /var/log/nginx/access.log security;
error_log /var/log/nginx/error.log warn;

# File upload security (if needed)
client_max_body_size 10M;
client_body_timeout 12;
client_header_timeout 12;
send_timeout 10;

# Keep connections alive
keepalive_timeout 5 5;
keepalive_requests 100;
